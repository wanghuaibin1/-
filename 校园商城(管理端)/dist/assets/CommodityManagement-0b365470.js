import{d as Z,r as v,p as f,h as u,o as ee,c as te,s as e,k as o,m as C,a6 as I,a7 as le,l as d,a as r,t as x,F as ae,K as oe,a4 as c,a8 as U}from"./index-ff0f60b8.js";import{e as se,f as ne,h as re,i as ie,p as ue,a as de}from"./business-704d43c4.js";import"./request-512292d2.js";const ce={class:"flex justify-between my-4"},pe={class:"flex"},me={style:{width:"100px",height:"100px"}},fe=r("div",{class:"image-slot"},[d("Loading"),r("span",{class:"dot"},"...")],-1),ge={class:"ml-2 flex justify-between flex-col"},ye={class:"indent-2 text-base",style:{"word-break":"break-all","text-overflow":"ellipsis",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":"3",overflow:"hidden","margin-bottom":"0"}},ve={style:{display:"flex","align-items":"center"}},_e={class:"text-red-800 font-bold"},be={class:"indent-4",style:{"word-break":"break-all","text-overflow":"ellipsis",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":"4",overflow:"hidden"}},we={class:"dialog-footer"},Se=Z({__name:"CommodityManagement",setup(ke){const{proxy:z}=oe(),y=v({name:"",productID:""}),F=f(),h=v({list:[{productId:17,productName:"骚炳的腰子",productDescription:"一个虚弱的腰子",price:.01,imgUrl:"http://www.javacg.icu:7742/img/6f5b5f08-a345-4551-abb4-62568b4b7f76.jpg",storeId:1,stockQuantity:2,productStatus:"上架",createTime:"2023-10-09T20:14:51.000+00:00"}]}),S=async()=>{if(y.name.length===0)return;const{data:a}=await se({name:y.name});h.list=a.value},Q=()=>{y.name="",_.value=1,b.value=5,p()},V=v({list:[]}),T=a=>{V.list=a},B=()=>{if(V.list.length===0)return c.error("未选择商品");U.confirm("确定要删除商品吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const a=[];V.list.forEach(n=>a.push(n.productId));const{data:t}=await ne(a);if(t.value){c({type:"success",message:"删除成功"}),p();return}c.error("删除失败")}).catch(()=>{c({type:"info",message:"已取消"})})},_=f(1),b=f(5),$=f(!1),q=f(!1),D=v({zo:200}),M=a=>{b.value=a,p()},j=a=>{_.value=a,p()},p=async()=>{const{data:a}=await re({yema:_.value,count:b.value});console.log(a),h.list=a.value.records,D.zo=a.value.total};p();const K=a=>{U.confirm("确定要删除商品吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const{data:t}=await ie({id:a.productId});if(t.value){c({type:"success",message:"删除成功"}),p();return}c.error("删除失败")}).catch(()=>{c({type:"info",message:"已取消"})})},R=async a=>{s.list=a,g.value=!0,k.value="修改"},k=f(""),w=f(),Y=v({productName:[{required:!0,message:"请填写商品名称",trigger:"blur"}],productStatus:[{required:!0,message:"请选择商品状态",trigger:"change"}],price:[{required:!0,validator:(a,t,n)=>{t===0?n(new Error("请填写商品价格")):n()},trigger:"change"}],stockQuantity:[{required:!0,validator:(a,t,n)=>{t===0?n(new Error("请填写商品库存")):n()},trigger:"change"}],productDescription:[{required:!0,message:"请填写商品描述",trigger:"blur"}]}),g=f(!1),s=v({list:{productId:"",productName:"",productStatus:"",price:"",stockQuantity:"",productDescription:""}}),E=async a=>{a&&await a.validate(async(t,n)=>{if(t){if(k.value==="发布"){const{data:i}=await ue({productName:s.list.productName,productDescription:s.list.productDescription,price:s.list.price,imgUrl:"",storeId:0,stockQuantity:s.list.stockQuantity,productStatus:s.list.productStatus,createTime:new Date});i.value&&(p(),c({type:"success",message:"添加成功"}),g.value=!1,a.resetFields())}else if(k.value==="修改"){const{data:i}=await de({productId:s.list.productId,productName:s.list.productName,productDescription:s.list.productDescription,price:s.list.price,imgUrl:"",storeId:0,stockQuantity:s.list.stockQuantity,productStatus:s.list.productStatus,createTime:new Date});i.value&&(p(),c({type:"success",message:"修改成功"}),g.value=!1,a.resetFields())}}else console.log("error submit!",n)})},H=a=>{a&&a.resetFields()};return(a,t)=>{const n=u("el-form-item"),i=u("el-button"),N=u("el-form"),m=u("el-table-column"),J=u("el-image"),L=u("el-table"),G=u("el-pagination"),P=u("el-option"),O=u("el-select"),A=u("el-input-number"),W=u("el-dialog");return ee(),te(ae,null,[e(N,{inline:!0,model:y,class:"demo-form-inline"},{default:o(()=>[e(n,{label:"商品名称"},{default:o(()=>[e(C(I),{onKeyup:le(S,["enter"]),modelValue:y.name,"onUpdate:modelValue":t[0]||(t[0]=l=>y.name=l),placeholder:"输入后回车搜索",clearable:""},null,8,["onKeyup","modelValue"])]),_:1}),e(n,null,{default:o(()=>[e(i,{type:"primary",onClick:S},{default:o(()=>[d("搜索")]),_:1}),e(i,{type:"success",onClick:Q},{default:o(()=>[d("重置")]),_:1})]),_:1})]),_:1},8,["model"]),r("div",null,[r("div",ce,[e(i,{type:"primary",onClick:t[1]||(t[1]=l=>(g.value=!0,k.value="发布"))},{default:o(()=>[d("发布商品")]),_:1}),r("div",null,[e(i,{type:"danger",onClick:B},{default:o(()=>[d("批量删除")]),_:1})])]),r("div",null,[e(L,{ref_key:"tableRef",ref:F,"row-key":"date",data:h.list,style:{width:"100%"},border:"","cell-style":{textAlign:"center"},"header-cell-style":{"text-align":"center"},onSelectionChange:T},{default:o(()=>[e(m,{type:"selection",width:"40"}),e(m,{prop:"avatar",label:"商品名称",width:"300"},{default:o(l=>[r("div",pe,[r("div",me,[e(J,{style:{width:"6.25rem",height:"6.25rem"},"preview-src-list":"",src:l.row.imgUrl[0],fit:"cover"},{placeholder:o(()=>[fe]),_:2},1032,["src"])]),r("div",ge,[r("p",ye,x(l.row.productName),1)])])]),_:1}),e(m,{prop:"price",label:"商品价格",sortable:""},{default:o(l=>[r("div",ve,[r("span",_e,"￥"+x(l.row.price),1)])]),_:1}),e(m,{prop:"stockQuantity",label:"商品库存",sortable:""}),e(m,{prop:"productStatus",label:"商品状态"}),e(m,{prop:"createTime",label:"创建时间",sortable:""},{default:o(l=>[d(x(C(z).$dayjs(l.row.createTime).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(m,{prop:"productDescription",label:"商品描述"},{default:o(l=>[r("div",null,[r("p",be,x(l.row.productDescription),1)])]),_:1}),e(m,{label:"操作"},{default:o(({row:l})=>[e(i,{type:"danger",onClick:X=>K(l)},{default:o(()=>[d("删除")]),_:2},1032,["onClick"]),e(i,{type:"success",onClick:X=>R(l)},{default:o(()=>[d("修改")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(G,{class:"mt-6","current-page":_.value,"onUpdate:currentPage":t[2]||(t[2]=l=>_.value=l),"page-size":b.value,"onUpdate:pageSize":t[3]||(t[3]=l=>b.value=l),"page-sizes":[5,10,15,20],disabled:q.value,background:$.value,layout:"total, sizes, prev, pager, next, jumper",total:D.zo,onSizeChange:M,onCurrentChange:j},null,8,["current-page","page-size","disabled","background","total"])])]),e(W,{modelValue:g.value,"onUpdate:modelValue":t[12]||(t[12]=l=>g.value=l),title:"商品信息",width:"50%",center:"","align-center":"",onClose:t[13]||(t[13]=l=>w.value.resetFields())},{footer:o(()=>[r("span",we,[e(i,{onClick:t[11]||(t[11]=l=>(g.value=!1,w.value.resetFields()))},{default:o(()=>[d("取消")]),_:1})])]),default:o(()=>[e(N,{inline:!0,model:s.list,"label-position":"right",size:"large",rules:Y,ref_key:"ruleFormRef",ref:w},{default:o(()=>[e(n,{label:"商品名称",prop:"productName",class:"w-full !mr-0"},{default:o(()=>[e(C(I),{modelValue:s.list.productName,"onUpdate:modelValue":t[4]||(t[4]=l=>s.list.productName=l),placeholder:"商品名称",clearable:""},null,8,["modelValue"])]),_:1}),e(n,{label:"商品状态",prop:"productStatus",class:"w-full !mr-0"},{default:o(()=>[e(O,{class:"w-full",modelValue:s.list.productStatus,"onUpdate:modelValue":t[5]||(t[5]=l=>s.list.productStatus=l),placeholder:"请选择商品状态",clearable:""},{default:o(()=>[e(P,{label:"已上架",value:"已上架"}),e(P,{label:"未上架",value:"未上架"})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"商品价格",prop:"price",class:"w-1/2 !mr-0"},{default:o(()=>[e(A,{modelValue:s.list.price,"onUpdate:modelValue":t[6]||(t[6]=l=>s.list.price=l),precision:1,step:.5,max:999,min:0},null,8,["modelValue"])]),_:1}),e(n,{label:"商品库存",prop:"stockQuantity",class:"w-1/2 !mr-0"},{default:o(()=>[e(A,{modelValue:s.list.stockQuantity,"onUpdate:modelValue":t[7]||(t[7]=l=>s.list.stockQuantity=l),min:0,step:1,"step-strictly":""},null,8,["modelValue"])]),_:1}),e(n,{label:"商品描述",prop:"productDescription",class:"w-full !mr-0"},{default:o(()=>[e(C(I),{modelValue:s.list.productDescription,"onUpdate:modelValue":t[8]||(t[8]=l=>s.list.productDescription=l),type:"textarea"},null,8,["modelValue"])]),_:1}),e(n,null,{default:o(()=>[e(i,{type:"primary",onClick:t[9]||(t[9]=l=>E(w.value))},{default:o(()=>[d(" 确定 ")]),_:1}),e(i,{onClick:t[10]||(t[10]=l=>H(w.value))},{default:o(()=>[d("重置")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])],64)}}});export{Se as default};
